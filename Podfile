platform :ios, '12.0'
source 'https://github.com/CocoaPods/Specs.git'

use_frameworks!

target 'Session' do
  pod 'AFNetworking', inhibit_warnings: true
  pod 'CryptoSwift', :inhibit_warnings => true
  pod 'Mantle', git: 'https://github.com/signalapp/Mantle', branch: 'signal-master', :inhibit_warnings => true
  pod 'NVActivityIndicatorView', :inhibit_warnings => true
  pod 'PromiseKit', :inhibit_warnings => true
  pod 'PureLayout', '~> 3.1.8', :inhibit_warnings => true
  pod 'Reachability', :inhibit_warnings => true
  pod 'Sodium', '~> 0.8.0', :inhibit_warnings => true
  pod 'YapDatabase/SQLCipher', :git => 'https://github.com/loki-project/session-ios-yap-database.git', branch: 'signal-release', :inhibit_warnings => true
  pod 'YYImage', git: 'https://github.com/signalapp/YYImage', :inhibit_warnings => true
  pod 'ZXingObjC', :inhibit_warnings => true
end

target 'SessionShareExtension' do
  pod 'AFNetworking', inhibit_warnings: true
  pod 'CryptoSwift', :inhibit_warnings => true
  pod 'Curve25519Kit', git: 'https://github.com/signalapp/Curve25519Kit.git', :inhibit_warnings => true
  pod 'Mantle', git: 'https://github.com/signalapp/Mantle', branch: 'signal-master', :inhibit_warnings => true
  pod 'PromiseKit', :inhibit_warnings => true
  pod 'PureLayout', '~> 3.1.8', :inhibit_warnings => true
  pod 'SignalCoreKit', git: 'https://github.com/signalapp/SignalCoreKit.git', :inhibit_warnings => true
  pod 'YapDatabase/SQLCipher', :git => 'https://github.com/loki-project/session-ios-yap-database.git', branch: 'signal-release', :inhibit_warnings => true
end

target 'SessionNotificationServiceExtension' do
  pod 'Curve25519Kit', git: 'https://github.com/signalapp/Curve25519Kit.git', :inhibit_warnings => true
  pod 'SignalCoreKit', git: 'https://github.com/signalapp/SignalCoreKit.git', :inhibit_warnings => true
  pod 'YapDatabase/SQLCipher', :git => 'https://github.com/loki-project/session-ios-yap-database.git', branch: 'signal-release', :inhibit_warnings => true
  pod 'PromiseKit', :inhibit_warnings => true
end

target 'SignalUtilitiesKit' do
  pod 'AFNetworking', inhibit_warnings: true
  pod 'CryptoSwift', :inhibit_warnings => true
  pod 'Curve25519Kit', git: 'https://github.com/signalapp/Curve25519Kit.git', :inhibit_warnings => true
  pod 'GRKOpenSSLFramework', :inhibit_warnings => true
  pod 'HKDFKit', :inhibit_warnings => true
  pod 'Mantle', git: 'https://github.com/signalapp/Mantle', branch: 'signal-master', :inhibit_warnings => true
  pod 'NVActivityIndicatorView', :inhibit_warnings => true
  pod 'PromiseKit', :inhibit_warnings => true
  pod 'PureLayout', '~> 3.1.8', :inhibit_warnings => true
  pod 'Reachability', :inhibit_warnings => true
  pod 'SAMKeychain', :inhibit_warnings => true
  pod 'SignalCoreKit', git: 'https://github.com/signalapp/SignalCoreKit.git', :inhibit_warnings => true
  pod 'SwiftProtobuf', '~> 1.5.0', :inhibit_warnings => true
  pod 'YapDatabase/SQLCipher', :git => 'https://github.com/loki-project/session-ios-yap-database.git', branch: 'signal-release', :inhibit_warnings => true
  pod 'YYImage', git: 'https://github.com/signalapp/YYImage', :inhibit_warnings => true
end

target 'SessionUIKit' do

end

target 'SessionMessagingKit' do
  pod 'AFNetworking', inhibit_warnings: true
  pod 'CryptoSwift', :inhibit_warnings => true
  pod 'Curve25519Kit', git: 'https://github.com/signalapp/Curve25519Kit.git', :inhibit_warnings => true
  pod 'HKDFKit', :inhibit_warnings => true
  pod 'Mantle', git: 'https://github.com/signalapp/Mantle', branch: 'signal-master', :inhibit_warnings => true
  pod 'PromiseKit', :inhibit_warnings => true
  pod 'PureLayout', '~> 3.1.8', :inhibit_warnings => true
  pod 'Reachability', :inhibit_warnings => true
  pod 'SAMKeychain', :inhibit_warnings => true
  pod 'SignalCoreKit', git: 'https://github.com/signalapp/SignalCoreKit.git', :inhibit_warnings => true
  pod 'Sodium', '~> 0.8.0', :inhibit_warnings => true
  pod 'SwiftProtobuf', '~> 1.5.0', :inhibit_warnings => true
  pod 'YapDatabase/SQLCipher', :git => 'https://github.com/loki-project/session-ios-yap-database.git', branch: 'signal-release', :inhibit_warnings => true
end

target 'SessionSnodeKit' do
  pod 'CryptoSwift', :inhibit_warnings => true
  pod 'Curve25519Kit', git: 'https://github.com/signalapp/Curve25519Kit.git', :inhibit_warnings => true
  pod 'PromiseKit', :inhibit_warnings => true
  pod 'SignalCoreKit', git: 'https://github.com/signalapp/SignalCoreKit.git', :inhibit_warnings => true
  pod 'Sodium', '~> 0.8.0', :inhibit_warnings => true
  pod 'YapDatabase/SQLCipher', :git => 'https://github.com/loki-project/session-ios-yap-database.git', branch: 'signal-release', :inhibit_warnings => true
end

target 'SessionUtilitiesKit' do
  pod 'AFNetworking', inhibit_warnings: true
  pod 'CryptoSwift', :inhibit_warnings => true
  pod 'Curve25519Kit', git: 'https://github.com/signalapp/Curve25519Kit.git', :inhibit_warnings => true
  pod 'Mantle', git: 'https://github.com/signalapp/Mantle', branch: 'signal-master', :inhibit_warnings => true
  pod 'PromiseKit', :inhibit_warnings => true
  pod 'PureLayout', '~> 3.1.8', :inhibit_warnings => true
  pod 'SAMKeychain', :inhibit_warnings => true
  pod 'SignalCoreKit', git: 'https://github.com/signalapp/SignalCoreKit.git', :inhibit_warnings => true
  pod 'YapDatabase/SQLCipher', :git => 'https://github.com/loki-project/session-ios-yap-database.git', branch: 'signal-release', :inhibit_warnings => true
end

post_install do |installer|
  enable_whole_module_optimization_for_crypto_swift(installer)
  set_minimum_deployment_target(installer)
end

def enable_whole_module_optimization_for_crypto_swift(installer)
  installer.pods_project.targets.each do |target|
    if target.name.end_with? "CryptoSwift"
      target.build_configurations.each do |config|
        config.build_settings['GCC_OPTIMIZATION_LEVEL'] = 'fast'
        config.build_settings['SWIFT_OPTIMIZATION_LEVEL'] = '-O'
      end
    end
  end
end

def set_minimum_deployment_target(installer)
  installer.pods_project.targets.each do |target|
    target.build_configurations.each do |build_configuration|
      build_configuration.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '12.0'
    end
  end
end
